<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.pearl.mapper.AdminMapper">

	<select id="boardList"
		resultType="com.pearl.domain.AdminBoardVO">
		select /*+INDEX(board board_pk)*/
		b.boardNum, b.boardTitle,
		b.memNum, m.memName, m.memEmail, b.boardDate
		from member m, board b
		where b.boardtype = 'c' and b.memNum = m.memNum
	</select>
	
   <select id="test" resultType="com.pearl.domain.MemberVO"> 
     select*from (select rownum rn, m.* from member m) where rn between #{pagiInfo.firstRecordIndex} and #{pagiInfo.lastRecordIndex}
   </select>
   
   <select id="selectTotalCount" resultType="int">
      select count(*) from member
      <include refid="sql-search.search" />
   </select>
   
   <select id="boardpage" resultType="com.pearl.domain.BoardVO">
   	select * from (select row_number() over(order by boarddate) rn,x.* 
	from (select b.*, m.memname, m.mememail from board b,member m where b.memnum = m.memnum) x )
	where rn between #{pagiInfo.firstRecordIndex} and #{pagiInfo.lastRecordIndex}
   </select>
   
   
   <select id="selectTotalCount2" resultType="int">
      select count(*) from board join member using(memnum) where boardtype='c'
      <include refid="sql-search.search" />
   </select>

 	<select id="fundpage" resultType="com.pearl.domain.AdminFundVO">
         select*from (select row_number() over(order by funddday) rn, y.*
    from  ( select f.*, x.nowtotal, m.memname, m.mememail from member m, fund f,
    (select f.fundnum, nvl(sum(paytotal),0) nowtotal from FUND F full outer join payment p on f.fundnum = p.fundnum
     group by f.fundnum) x where f.memnum = m.memnum and x.fundnum = f.fundnum) y  )
     where rn between #{pagiInfo.firstRecordIndex} and #{pagiInfo.lastRecordIndex}
  	</select>


	<select id="selectTotalCount3" resultType="int">
      select count(*) from fund f, member m, payment p where f.fundnum = p.fundnum and f.memnum = m.memnum 
      <include refid="sql-search.search" />
   </select>

 	<select id="paymentpage" resultType="com.pearl.domain.AdminPaymentVO">
  	select*from (select rownum rn, p.* from payment p) where rn between #{pagiInfo.firstRecordIndex} and #{pagiInfo.lastRecordIndex}
  	</select>


	<select id="selectTotalCount4" resultType="int">
      select count(*) from payment 
      <include refid="sql-search.search" />
   </select>




	<select id="fundList" resultType="com.pearl.domain.AdminFundVO">
		select /*+INDEX(fund fund_pk)*/
		f.fundNum, m.memNum, m.memName, m.memEmail, f.fundStartDate,
		f.fundEndDate, f.fundMoney, f.fundTitle, fundIntro
		from member m, fund
		f
		where f.memNum = m.memNum
	</select>



	<select id="paymentList"
		resultType="com.pearl.domain.AdminPaymentVO">
		select /*+INDEX(payment payment_pk)*/
		*
		from payment
	</select>

	<select id="searchPaymentList"
		resultType="com.pearl.domain.AdminPaymentVO">
		select /*+INDEX(payment payment_pk)*/
		*
		from payment
		<if test="searchType == 'all'">
		
		</if>
		<if test="searchType == 'payNum'">
			where payNum = #{searchValue}
		</if>
		<if test="searchType == 'memNum'">
			where memNum = #{searchValue}
		</if>
		<if test="searchType == 'fundNum'">
			where fundNum = #{searchValue}
		</if>
	</select>




	<delete id="fundDelete">
		DELETE FROM fund
		<where>
			<foreach item="fundNum" index="index" collection="array"
				open="fundNum IN (" close=")" separator=",">
				#{fundNum}
			</foreach>
		</where>
	</delete>

	<delete id="memberDelete">
		DELETE FROM member
		<where>
			<foreach item="memNum" index="index" collection="array"
				open="memNum IN (" close=")" separator=",">
				#{memNum}
			</foreach>
		</where>
	</delete>

	<delete id="postDelete">
		DELETE FROM board
		<where>
			<foreach item="boardNum" index="index" collection="array"
				open="boardNum IN (" close=")" separator=",">
				#{boardNum}
			</foreach>
		</where>
	</delete>

</mapper>