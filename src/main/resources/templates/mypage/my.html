<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
	<head th:insert="/fragments/head.html::head" th:remove="tag">
	</head>
	<meta name="_csrf" th:content="${_csrf.token}"/>
	<meta name="_csrf_header" th:content="${_csrf.headerName}"/>
</head>
  <body>

   <header th:replace="fragments/header :: header"> </header>
   
   <style>
   #fundmore.hover{
   		background-color: black;
   		font-style: white;
   }
   
   </style>
   
    <section class="hero-wrap hero-wrap-2"  data-stellar-background-ratio="0.5">
      <div class="overlay"></div>
      <div class="container">
        <div class="row no-gutters slider-text align-items-end">
          <div class="col-md-9 ftco-animate pb-5">
          	<p class="breadcrumbs mb-2"><span class="mr-2"><a href='/'>Home 
          	<i class="ion-ios-arrow-forward"></i></a></span></p>
            <h1 class="mb-0 bread">My Page</h1>
          </div>
        </div>
      </div>
    </section>
    
    <div>
    <img th:src="@{/images/profile.jpg}" width="300" height="300" class="pic">
    	<input type="hidden" th:value="${meminfo.memNum}" name="memNum">
    	<input type="hidden" sec:authorize="isAuthenticated()" th:value="${#authentication.principal.member.memNum}" name="userNum">
    		<span class="nickname" th:text="${meminfo.memName}"></span>
    		<input type="button" value="Edit" class="edit" 
    			onClick="location.href='/mypage/edit'" style="cursor:pointer"
    			th:if="${#authentication.name}==${meminfo.memEmail}">
    		<span class="num1">0</span><span class="num3">Photo</span>
    		<span class="num2" id="subscribe" th:text="${subscriber}">0</span><span class="num4">subscriber</span>
    		<input type="button" value="Donation" class="Donation" id="donation" style="cursor:pointer"
    			th:if="${#authentication.name}!=${meminfo.memEmail}">
    		<input type="button" value="Subscribe" class="Subscribe" id="btnSub" style="cursor:pointer"
    			th:if="${#authentication.name}!=${meminfo.memEmail}" onclick="addSubscribe()">
    </div><hr><hr>
<a class="btn d-block" id="fundmore" href='/fund/fundList'>
			<span th:if="${#authentication.name}!=${meminfo.memEmail}" th:text="${meminfo.memName+'님의 펀딩 보러가기→'}">
			</span>
			<span th:if="${#authentication.name}==${meminfo.memEmail}">내 펀딩 보러가기→
			</span></a>
			
	
    <section class="ftco-section bg-light">
			<div class="container">
				<div class="row mt-4 d-flex">
					<div class="col-md-6 col-lg-3 ftco-animate" th:each="gallery : ${myGallery}" th:object="${gallery.picture}">
						<div class="staff">
							<div class="img-wrap d-flex align-items-stretch">
								<a th:href="|@{/gallery/get}?boardNum=${gallery.boardNum}|" 
              class="img align-self-stretch" 
              th:style="'background-image: url(/gallery/display?fileName='+*{picPath}+'/'+*{picUuid}+'_'+*{picName}+'.'+*{picTail}+');'" th:if="${gallery.picture} ne null">
              </a>
							</div>
							<div class="text pt-3 px-3 pb-4 text-center">
 								<a th:href="@{/gallery/get(boardNum=${gallery.boardNum})}"><h3 th:text="${gallery.boardTitle}">Title</h3></a>
								<span class="position mb-2" th:text="${gallery.boardDate}">Date</span>
								<div class="faded">
									<p th:text="${gallery.boardContent}">Content</p>
									<ul class="ftco-social text-center">
		                <li class="ftco-animate"><a href="#" class="d-flex align-items-center justify-content-center"><span class="fa fa-twitter"></span></a></li>
		                <li class="ftco-animate"><a href="#" class="d-flex align-items-center justify-content-center"><span class="fa fa-facebook"></span></a></li>
		                <li class="ftco-animate"><a href="#" class="d-flex align-items-center justify-content-center"><span class="fa fa-google"></span></a></li>
		                <li class="ftco-animate"><a href="#" class="d-flex align-items-center justify-content-center"><span class="fa fa-instagram"></span></a></li>
		              </ul>
	              </div>
							</div>
						</div>
					</div>
				</div>
			</div>
			<!-- <div class="black_bg" id="black_bg"></div>
			<div class="modal" id="modal">
				<div class="modal_close"><a href="#close">Close</a></div>
				<div>
				어쩌구 저쩌구 
				</div>
			</div> -->			
		</section>
		<script th:inline="javascript">
			  var subs = [[${subs}]];
			
			function addSubscribe(){
				var artist = $("input[name=memNum]").val();
				var audience = $("input[name=userNum]").val();
				var token = $("meta[name='_csrf']").attr("content");
				var header = $("meta[name='_csrf_header']").attr("content");
				var param = {"artist":artist*1, "audience":audience*1}
				console.log(param);
				$.ajax({
					method : 'POST',
					url:'/subscribe',
					data: JSON.stringify(param),
					beforeSend: function(xhr){
						xhr.setRequestHeader(header, token);
					},
					dataType:'text',
					contentType:'application/json; charset=utf-8',
					success:function(data){
						if($('#btnSub').val()=='Subscribe'){
						 	alert("구독하셨습니다");
						 	$('#btnSub').css('background-color', 'pink');
							$('#btnSub').val('Subscribed');
						}else {
						 	alert("구독해지하셨습니다");
						 	$('#btnSub').css('background-color', '#f54e4e');
							$('#btnSub').val('Subscribe');
						}
					 	$('#subscribe').text(data);
						console.log(data);
				 	},error:function(e){
				 		console.log("ERROR : ", e);
			            alert("로그인후 이용가능합니다.");
			            //location.href="/login";
					}
				});
			}
		$(function(){
			if(subs=="true"){
				$('#btnSub').css('background-color', 'pink');
				$('#btnSub').val('Subscribed');
			}
		});
		
		
		
		/*  $( document ).ready( function() {
			 
			window.onload = function() {
		 
			function onClick() {
				
			document.querySelector('#block_kg').style.display='block';
			document.querySelector('#modal').style.display='block';
			}
			
			function offClick() {
			document.querySelector('#block_kg').style.display='none';
			document.querySelector('#modal').style.display='none';
				
			}
				
			document.getElementById("#donation").addEventListener('click',onClick);
			document.getElementById(".modal_close").addEventListener('click',offClick);

			 }
		    		
		    }); */
		    
		
		</script>
<footer th:replace="fragments/footer :: footer"> </footer>
    
  </body>
</html>